diff -ur original/0ad-0.0.22-alpha/build/premake/premake4/build/gmake.unix/Premake4.make 0ad-0.0.22-alpha/build/premake/premake4/build/gmake.unix/Premake4.make
--- original/0ad-0.0.22-alpha/build/premake/premake4/build/gmake.unix/Premake4.make	2012-07-22 02:52:37.033816576 +0000
+++ 0ad-0.0.22-alpha/build/premake/premake4/build/gmake.unix/Premake4.make	2017-12-03 08:10:09.761004032 +0000
@@ -28,8 +28,8 @@
   CPPFLAGS  += -MMD -MP $(DEFINES) $(INCLUDES)
   CFLAGS    += $(CPPFLAGS) -Wall -Os
   CXXFLAGS  += $(CPPFLAGS) -Wall -Os
-  LDFLAGS   += -s -rdynamic
-  LIBS      += -lm -ldl 
+  LDFLAGS   += -s -Wl,--export-dynamic
+  LIBS      += -lm 
   RESFLAGS  += $(DEFINES) $(INCLUDES) 
   LDDEPS    += 
   LINKCMD    = $(CC) -o $(TARGET) $(OBJECTS) $(LDFLAGS) $(RESOURCES) $(LDDEPS) $(LIBS)
@@ -61,56 +61,56 @@
   endef
   define POSTBUILDCMDS
   endef
-endif
-
-OBJECTS := \
-	$(OBJDIR)/path_isabsolute.o \
-	$(OBJDIR)/os_getversion.o \
-	$(OBJDIR)/os_isfile.o \
-	$(OBJDIR)/os_uuid.o \
-	$(OBJDIR)/os_chdir.o \
-	$(OBJDIR)/os_pathsearch.o \
-	$(OBJDIR)/os_rmdir.o \
-	$(OBJDIR)/os_match.o \
-	$(OBJDIR)/scripts.o \
-	$(OBJDIR)/os_copyfile.o \
-	$(OBJDIR)/os_isdir.o \
-	$(OBJDIR)/os_mkdir.o \
-	$(OBJDIR)/os_getcwd.o \
-	$(OBJDIR)/premake.o \
-	$(OBJDIR)/string_endswith.o \
-	$(OBJDIR)/loadlib.o \
-	$(OBJDIR)/ldebug.o \
-	$(OBJDIR)/lstring.o \
-	$(OBJDIR)/lparser.o \
-	$(OBJDIR)/lfunc.o \
-	$(OBJDIR)/ldump.o \
-	$(OBJDIR)/liolib.o \
-	$(OBJDIR)/lgc.o \
-	$(OBJDIR)/lundump.o \
-	$(OBJDIR)/lopcodes.o \
-	$(OBJDIR)/lmem.o \
-	$(OBJDIR)/lstate.o \
-	$(OBJDIR)/ltm.o \
-	$(OBJDIR)/ldo.o \
-	$(OBJDIR)/lzio.o \
-	$(OBJDIR)/lstrlib.o \
-	$(OBJDIR)/lapi.o \
-	$(OBJDIR)/lbaselib.o \
-	$(OBJDIR)/ltablib.o \
-	$(OBJDIR)/llex.o \
-	$(OBJDIR)/loslib.o \
-	$(OBJDIR)/ltable.o \
-	$(OBJDIR)/linit.o \
-	$(OBJDIR)/ldblib.o \
-	$(OBJDIR)/lmathlib.o \
-	$(OBJDIR)/lobject.o \
-	$(OBJDIR)/lvm.o \
-	$(OBJDIR)/lcode.o \
-	$(OBJDIR)/lauxlib.o \
-
-RESOURCES := \
-
+endif
+
+OBJECTS := \
+	$(OBJDIR)/path_isabsolute.o \
+	$(OBJDIR)/os_getversion.o \
+	$(OBJDIR)/os_isfile.o \
+	$(OBJDIR)/os_uuid.o \
+	$(OBJDIR)/os_chdir.o \
+	$(OBJDIR)/os_pathsearch.o \
+	$(OBJDIR)/os_rmdir.o \
+	$(OBJDIR)/os_match.o \
+	$(OBJDIR)/scripts.o \
+	$(OBJDIR)/os_copyfile.o \
+	$(OBJDIR)/os_isdir.o \
+	$(OBJDIR)/os_mkdir.o \
+	$(OBJDIR)/os_getcwd.o \
+	$(OBJDIR)/premake.o \
+	$(OBJDIR)/string_endswith.o \
+	$(OBJDIR)/loadlib.o \
+	$(OBJDIR)/ldebug.o \
+	$(OBJDIR)/lstring.o \
+	$(OBJDIR)/lparser.o \
+	$(OBJDIR)/lfunc.o \
+	$(OBJDIR)/ldump.o \
+	$(OBJDIR)/liolib.o \
+	$(OBJDIR)/lgc.o \
+	$(OBJDIR)/lundump.o \
+	$(OBJDIR)/lopcodes.o \
+	$(OBJDIR)/lmem.o \
+	$(OBJDIR)/lstate.o \
+	$(OBJDIR)/ltm.o \
+	$(OBJDIR)/ldo.o \
+	$(OBJDIR)/lzio.o \
+	$(OBJDIR)/lstrlib.o \
+	$(OBJDIR)/lapi.o \
+	$(OBJDIR)/lbaselib.o \
+	$(OBJDIR)/ltablib.o \
+	$(OBJDIR)/llex.o \
+	$(OBJDIR)/loslib.o \
+	$(OBJDIR)/ltable.o \
+	$(OBJDIR)/linit.o \
+	$(OBJDIR)/ldblib.o \
+	$(OBJDIR)/lmathlib.o \
+	$(OBJDIR)/lobject.o \
+	$(OBJDIR)/lvm.o \
+	$(OBJDIR)/lcode.o \
+	$(OBJDIR)/lauxlib.o \
+
+RESOURCES := \
+
 SHELLTYPE := msdos
 ifeq (,$(ComSpec)$(COMSPEC))
   SHELLTYPE := posix
@@ -165,141 +165,141 @@
 $(GCH): $(PCH) | $(OBJDIR)
 	@echo $(notdir $<)
 	-$(SILENT) cp $< $(OBJDIR)
-	$(SILENT) $(CC) $(CFLAGS) -o "$@" -c "$<"
-endif
-
-$(OBJDIR)/path_isabsolute.o: ../../src/host/path_isabsolute.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/path_isabsolute.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/os_getversion.o: ../../src/host/os_getversion.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_getversion.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/os_isfile.o: ../../src/host/os_isfile.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_isfile.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/os_uuid.o: ../../src/host/os_uuid.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_uuid.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/os_chdir.o: ../../src/host/os_chdir.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_chdir.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/os_pathsearch.o: ../../src/host/os_pathsearch.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_pathsearch.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/os_rmdir.o: ../../src/host/os_rmdir.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_rmdir.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/os_match.o: ../../src/host/os_match.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_match.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/scripts.o: ../../src/host/scripts.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/scripts.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/os_copyfile.o: ../../src/host/os_copyfile.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_copyfile.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/os_isdir.o: ../../src/host/os_isdir.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_isdir.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/os_mkdir.o: ../../src/host/os_mkdir.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_mkdir.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/os_getcwd.o: ../../src/host/os_getcwd.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_getcwd.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/premake.o: ../../src/host/premake.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/premake.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/string_endswith.o: ../../src/host/string_endswith.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/string_endswith.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/loadlib.o: ../../src/host/lua-5.1.4/src/loadlib.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/loadlib.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/ldebug.o: ../../src/host/lua-5.1.4/src/ldebug.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ldebug.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lstring.o: ../../src/host/lua-5.1.4/src/lstring.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lstring.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lparser.o: ../../src/host/lua-5.1.4/src/lparser.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lparser.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lfunc.o: ../../src/host/lua-5.1.4/src/lfunc.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lfunc.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/ldump.o: ../../src/host/lua-5.1.4/src/ldump.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ldump.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/liolib.o: ../../src/host/lua-5.1.4/src/liolib.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/liolib.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lgc.o: ../../src/host/lua-5.1.4/src/lgc.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lgc.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lundump.o: ../../src/host/lua-5.1.4/src/lundump.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lundump.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lopcodes.o: ../../src/host/lua-5.1.4/src/lopcodes.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lopcodes.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lmem.o: ../../src/host/lua-5.1.4/src/lmem.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lmem.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lstate.o: ../../src/host/lua-5.1.4/src/lstate.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lstate.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/ltm.o: ../../src/host/lua-5.1.4/src/ltm.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ltm.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/ldo.o: ../../src/host/lua-5.1.4/src/ldo.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ldo.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lzio.o: ../../src/host/lua-5.1.4/src/lzio.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lzio.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lstrlib.o: ../../src/host/lua-5.1.4/src/lstrlib.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lstrlib.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lapi.o: ../../src/host/lua-5.1.4/src/lapi.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lapi.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lbaselib.o: ../../src/host/lua-5.1.4/src/lbaselib.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lbaselib.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/ltablib.o: ../../src/host/lua-5.1.4/src/ltablib.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ltablib.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/llex.o: ../../src/host/lua-5.1.4/src/llex.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/llex.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/loslib.o: ../../src/host/lua-5.1.4/src/loslib.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/loslib.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/ltable.o: ../../src/host/lua-5.1.4/src/ltable.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ltable.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/linit.o: ../../src/host/lua-5.1.4/src/linit.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/linit.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/ldblib.o: ../../src/host/lua-5.1.4/src/ldblib.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ldblib.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lmathlib.o: ../../src/host/lua-5.1.4/src/lmathlib.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lmathlib.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lobject.o: ../../src/host/lua-5.1.4/src/lobject.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lobject.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lvm.o: ../../src/host/lua-5.1.4/src/lvm.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lvm.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lcode.o: ../../src/host/lua-5.1.4/src/lcode.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lcode.d -MT "$@" -o "$@" -c "$<"
-$(OBJDIR)/lauxlib.o: ../../src/host/lua-5.1.4/src/lauxlib.c $(GCH) | prebuild
-	@echo $(notdir $<)
-	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lauxlib.d -MT "$@" -o "$@" -c "$<"
-
--include $(OBJECTS:%.o=%.d)
--include $(GCH:%.h.gch=%.h.d)
\ No newline at end of file
+	$(SILENT) $(CC) $(CFLAGS) -o "$@" -c "$<"
+endif
+
+$(OBJDIR)/path_isabsolute.o: ../../src/host/path_isabsolute.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/path_isabsolute.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/os_getversion.o: ../../src/host/os_getversion.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_getversion.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/os_isfile.o: ../../src/host/os_isfile.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_isfile.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/os_uuid.o: ../../src/host/os_uuid.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_uuid.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/os_chdir.o: ../../src/host/os_chdir.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_chdir.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/os_pathsearch.o: ../../src/host/os_pathsearch.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_pathsearch.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/os_rmdir.o: ../../src/host/os_rmdir.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_rmdir.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/os_match.o: ../../src/host/os_match.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_match.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/scripts.o: ../../src/host/scripts.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/scripts.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/os_copyfile.o: ../../src/host/os_copyfile.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_copyfile.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/os_isdir.o: ../../src/host/os_isdir.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_isdir.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/os_mkdir.o: ../../src/host/os_mkdir.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_mkdir.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/os_getcwd.o: ../../src/host/os_getcwd.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/os_getcwd.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/premake.o: ../../src/host/premake.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/premake.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/string_endswith.o: ../../src/host/string_endswith.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/string_endswith.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/loadlib.o: ../../src/host/lua-5.1.4/src/loadlib.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/loadlib.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/ldebug.o: ../../src/host/lua-5.1.4/src/ldebug.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ldebug.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lstring.o: ../../src/host/lua-5.1.4/src/lstring.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lstring.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lparser.o: ../../src/host/lua-5.1.4/src/lparser.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lparser.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lfunc.o: ../../src/host/lua-5.1.4/src/lfunc.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lfunc.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/ldump.o: ../../src/host/lua-5.1.4/src/ldump.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ldump.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/liolib.o: ../../src/host/lua-5.1.4/src/liolib.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/liolib.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lgc.o: ../../src/host/lua-5.1.4/src/lgc.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lgc.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lundump.o: ../../src/host/lua-5.1.4/src/lundump.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lundump.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lopcodes.o: ../../src/host/lua-5.1.4/src/lopcodes.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lopcodes.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lmem.o: ../../src/host/lua-5.1.4/src/lmem.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lmem.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lstate.o: ../../src/host/lua-5.1.4/src/lstate.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lstate.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/ltm.o: ../../src/host/lua-5.1.4/src/ltm.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ltm.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/ldo.o: ../../src/host/lua-5.1.4/src/ldo.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ldo.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lzio.o: ../../src/host/lua-5.1.4/src/lzio.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lzio.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lstrlib.o: ../../src/host/lua-5.1.4/src/lstrlib.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lstrlib.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lapi.o: ../../src/host/lua-5.1.4/src/lapi.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lapi.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lbaselib.o: ../../src/host/lua-5.1.4/src/lbaselib.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lbaselib.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/ltablib.o: ../../src/host/lua-5.1.4/src/ltablib.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ltablib.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/llex.o: ../../src/host/lua-5.1.4/src/llex.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/llex.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/loslib.o: ../../src/host/lua-5.1.4/src/loslib.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/loslib.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/ltable.o: ../../src/host/lua-5.1.4/src/ltable.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ltable.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/linit.o: ../../src/host/lua-5.1.4/src/linit.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/linit.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/ldblib.o: ../../src/host/lua-5.1.4/src/ldblib.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/ldblib.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lmathlib.o: ../../src/host/lua-5.1.4/src/lmathlib.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lmathlib.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lobject.o: ../../src/host/lua-5.1.4/src/lobject.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lobject.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lvm.o: ../../src/host/lua-5.1.4/src/lvm.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lvm.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lcode.o: ../../src/host/lua-5.1.4/src/lcode.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lcode.d -MT "$@" -o "$@" -c "$<"
+$(OBJDIR)/lauxlib.o: ../../src/host/lua-5.1.4/src/lauxlib.c $(GCH) | prebuild
+	@echo $(notdir $<)
+	$(SILENT) $(CC) $(PCHINCLUDES) $(CFLAGS) -MF $(OBJDIR)/lauxlib.d -MT "$@" -o "$@" -c "$<"
+
+-include $(OBJECTS:%.o=%.d)
+-include $(GCH:%.h.gch=%.h.d)
diff -ur original/0ad-0.0.22-alpha/build/premake/premake4/premake4.lua 0ad-0.0.22-alpha/build/premake/premake4/premake4.lua
--- original/0ad-0.0.22-alpha/build/premake/premake4/premake4.lua	2012-08-19 18:49:02.033292288 +0000
+++ 0ad-0.0.22-alpha/build/premake/premake4/premake4.lua	2017-12-03 08:06:49.206569472 +0000
@@ -65,12 +65,15 @@
 			buildoptions{ "-mmacosx-version-min=10.4" }
 			linkoptions { "-mmacosx-version-min=10.4" }
 
-		configuration { "not windows", "not solaris", "not macosx" }
+		configuration { "not windows", "not solaris", "not 
+macosx", "not haiku" }
 			linkoptions { "-rdynamic" }
 			
 		configuration { "solaris" }
 			linkoptions { "-Wl,--export-dynamic" }
 
+		configuration { "haiku" }
+			linkoptions { "-Wl,--export-dynamic" }
 
 
 --
diff -ur original/0ad-0.0.22-alpha/build/premake/premake4.lua 0ad-0.0.22-alpha/build/premake/premake4.lua
--- original/0ad-0.0.22-alpha/build/premake/premake4.lua	2017-07-06 17:29:49.012845056 +0000
+++ 0ad-0.0.22-alpha/build/premake/premake4.lua	2017-12-03 08:39:11.733216768 +0000
@@ -832,6 +832,7 @@
 		windows = { "lib/sysdep/os/win", "lib/sysdep/os/win/wposix", "lib/sysdep/os/win/whrt" },
 		macosx = { "lib/sysdep/os/osx", "lib/sysdep/os/unix" },
 		bsd = { "lib/sysdep/os/bsd", "lib/sysdep/os/unix", "lib/sysdep/os/unix/x" },
+		haiku = { "lib/sysdep/os/unix" }
 	}
 	for i,v in pairs(sysdep_dirs[os.get()]) do
 		table.insert(source_dirs, v);
diff -ur original/0ad-0.0.22-alpha/build/workspaces/update-workspaces.sh 0ad-0.0.22-alpha/build/workspaces/update-workspaces.sh
--- original/0ad-0.0.22-alpha/build/workspaces/update-workspaces.sh	2016-09-02 16:18:57.049807360 +0000
+++ 0ad-0.0.22-alpha/build/workspaces/update-workspaces.sh	2017-12-03 09:13:04.544473088 +0000
@@ -1,9 +1,10 @@
 #!/bin/sh
 
-if [ "$(id -u)" = "0" ]; then
-   echo "Running as root will mess up file permissions. Aborting ..." 1>&2
-   exit 1
-fi
+#if [ "$(id -u)" = "0" ]; then
+#   echo "Running as root will mess up file permissions. Aborting ..." 
+#1>&2
+#   exit 1
+#fi
 
 die()
 {
@@ -34,14 +35,19 @@
     ;;
 esac
 
+if [ "`uname -s`" = "Haiku" ]; then
+    #Haiku requires the g++-x86 compiler to compile C++11 applications.
+    MAKE="make CC=gcc-x86 CXX=g++-x86"
+fi
+
 # Parse command-line options:
 
 premake_args=""
 
-without_nvtt=false
+without_nvtt=true
 with_system_nvtt=false
 with_system_mozjs38=false
-enable_atlas=true
+enable_atlas=false
 
 for i in "$@"
 do
@@ -81,10 +87,12 @@
   echo
 
   # Build/update bundled external libraries
+  echo ${MAKE}
   (cd ../../libraries/source/fcollada/src && ${MAKE} ${JOBS}) || die "FCollada build failed"
   echo
   if [ "$with_system_mozjs38" = "false" ]; then
-    (cd ../../libraries/source/spidermonkey && MAKE=${MAKE} JOBS=${JOBS} ./build.sh) || die "SpiderMonkey build failed"
+    (cd ../../libraries/source/spidermonkey && MAKE=${MAKE} JOBS=${JOBS} 
+./build.sh) || die "SpiderMonkey build failed"
   fi
   echo
   if [ "$with_system_nvtt" = "false" ] && [ "$without_nvtt" = "false" ]; then
Only in 0ad-0.0.22-alpha/libraries/source/fcollada/lib: libFColladaSD.a
Only in 0ad-0.0.22-alpha/libraries/source/fcollada/lib: libFColladaSR.a
diff -ur original/0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUAssert.cpp 0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUAssert.cpp
--- original/0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUAssert.cpp	2017-07-10 21:53:47.036175872 +0000
+++ 0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUAssert.cpp	2017-12-02 11:13:54.025690112 +0000
@@ -12,7 +12,12 @@
 #include "FUAssert.h"
 
 #ifndef WIN32
-	#include "sys/signal.h" // Used for throw(SIGTRAP) on UNIX-like systems
+	#ifdef __HAIKU__
+		#include <signal.h>
+	#else
+		#include "sys/signal.h" // Used for throw(SIGTRAP) on 
+UNIX-like systems
+	#endif
 #endif
 
 #ifdef __APPLE__
diff -ur original/0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUPluginManager.cpp 0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUPluginManager.cpp
--- original/0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUPluginManager.cpp	2010-04-19 21:56:45.031981568 +0000
+++ 0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUPluginManager.cpp	2017-12-02 11:33:23.904396800 +0000
@@ -29,6 +29,10 @@
 	#include <dirent.h>
 #endif //WIN32
 
+#ifdef __HAIKU__
+	#include <sys/stat.h>
+#endif
+
 //
 // FUPlugin
 //
@@ -129,6 +133,10 @@
 		}
 
 #elif defined(__APPLE__) || defined(LINUX)
+	#ifdef __HAIKU__
+		struct stat s;
+	#endif
+
 		fm::string s_filter = TO_STRING(filter);
 		if (s_filter.length() > 0 && s_filter.front() == '*') s_filter.erase(0, 1);
 		if (s_filter.length() > 0 && s_filter.back() == '*') s_filter.pop_back();
@@ -139,7 +147,13 @@
 		dirent* directoryEntry;
 		while ((directoryEntry = readdir(directory)) != NULL)
 		{
+#ifndef __HAIKU__
 			if (directoryEntry->d_type == DT_DIR) continue; // skip sub-folders.
+#else
+			stat(directoryEntry->d_name, &s);
+			if (S_ISDIR(s.st_mode)) continue;		
+#endif
+		}
 			if (strstr((const char*) directoryEntry->d_name, s_filter.c_str()) != NULL)
 			{
 				// We have a match.
@@ -162,8 +176,8 @@
 				if (keep) loadedLibraries.push_back(library);
 				else { SAFE_DELETE(library); }
 			}
-		}
-		closedir(directory);
+		
+			closedir(directory);
 
 #endif // WIN32
 	} while (_filter != NULL);
diff -ur original/0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUStringBuilder.h 0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUStringBuilder.h
--- original/0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUStringBuilder.h	2012-06-04 21:33:15.033554432 +0000
+++ 0ad-0.0.22-alpha/libraries/source/fcollada/src/FCollada/FUtils/FUStringBuilder.h	2017-12-02 10:39:43.400556032 +0000
@@ -135,7 +135,7 @@
 #else
 	inline void append(unsigned int i) { append((uint32) i); } /**< See above. */
 #endif
-#elif defined(__APPLE__) || defined(__OpenBSD__)
+#elif defined(__APPLE__) || defined(__OpenBSD__) || defined(__HAIKU__)
 	inline void append(size_t i) { append((uint64)i); }
 #endif // defined(WIN32)
 
diff -ur original/0ad-0.0.22-alpha/libraries/source/nvtt/src/src/nvcore/nvcore.h 0ad-0.0.22-alpha/libraries/source/nvtt/src/src/nvcore/nvcore.h
--- original/0ad-0.0.22-alpha/libraries/source/nvtt/src/src/nvcore/nvcore.h	2015-07-21 15:53:21.018612224 +0000
+++ 0ad-0.0.22-alpha/libraries/source/nvtt/src/src/nvcore/nvcore.h	2017-12-02 20:46:24.672399360 +0000
@@ -36,6 +36,9 @@
 #define NV_OS_STRING 	POSH_OS_STRING
 
 #if defined POSH_OS_LINUX
+//#	define NV_OS_LINUX 1
+#	define NV_OS_UNIX 1
+#elif defined __HAIKU__
 #	define NV_OS_LINUX 1
 #	define NV_OS_UNIX 1
 #elif defined POSH_OS_FREEBSD
diff -ur original/0ad-0.0.22-alpha/libraries/source/spidermonkey/build.sh 0ad-0.0.22-alpha/libraries/source/spidermonkey/build.sh
--- original/0ad-0.0.22-alpha/libraries/source/spidermonkey/build.sh	2016-10-04 15:01:34.023855104 +0000
+++ 0ad-0.0.22-alpha/libraries/source/spidermonkey/build.sh	2017-12-03 12:22:02.911998976 +0000
@@ -22,13 +22,22 @@
 then
   MAKE="mozmake"
 else
-  MAKE=${MAKE:="make"}
+  if [ "`uname -s`" = "Haiku" ]; then
+    MAKE=${MAKE:="make CC=gcc-x86 CXX=g++x86"}
+  else
+    MAKE=${MAKE:="make"}
+  fi
 fi
 
 MAKE_OPTS="${JOBS}"
 
 CONF_OPTS="--enable-shared-js --disable-tests --without-intl-api"
 
+if [ "`uname -s`" = "Haiku" ]; then
+    export CC=gcc-x86 CXX=g++-x86 #GCC 4.7 or newer must be used.
+    export SHELL=/bin/bash
+fi
+
 # Bug 1269319
 # When compiled with GCC 6 (or later), SpiderMonkey 38 (and versions up to 49) is
 # subject to segfaults. Disabling a few optimizations fixes that.
diff -ur original/0ad-0.0.22-alpha/source/lib/secure_crt.h 0ad-0.0.22-alpha/source/lib/secure_crt.h
--- original/0ad-0.0.22-alpha/source/lib/secure_crt.h	2017-07-10 14:26:24.008126464 +0000
+++ 0ad-0.0.22-alpha/source/lib/secure_crt.h	2017-12-03 09:07:26.405798912 +0000
@@ -53,7 +53,7 @@
 // first <max_len> characters are examined; if the null character is
 // not encountered by then, <max_len> is returned.
 // strnlen is available on OpenBSD
-#if !OS_OPENBSD
+#if !OS_OPENBSD && !defined(__HAIKU__)
 extern size_t strnlen(const char* str, size_t max_len);
 #endif
 extern size_t wcsnlen(const wchar_t* str, size_t max_len);
